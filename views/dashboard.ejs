<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - StudySync</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body class="dashboard-body">
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>StudySync</h3>
                <button class="btn-close d-md-none" id="close-sidebar"></button>
            </div>
            <div class="sidebar-user">
                <img src="https://ui-avatars.com/api/?name=<%= user.username %>&background=4361ee&color=fff" alt="User" class="user-avatar">
                <div class="user-info">
                    <h5><%= user.username %></h5>
                    <p><%= user.role %></p>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li class="active">
                    <a href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                </li>
                <li>
                    <a href="/courses"><i class="fas fa-book"></i> My Courses</a>
                </li>
                <li>
                    <a href="/schedule"><i class="fas fa-calendar"></i> Schedule</a>
                </li>
                <li>
                    <a href="/tasks"><i class="fas fa-tasks"></i> Tasks</a>
                </li>
                <li>
                    <a href="/messages"><i class="fas fa-comments"></i> Messages</a>
                </li>
                <li>
                    <a href="/settings"><i class="fas fa-cog"></i> Settings</a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navbar -->
            <nav class="navbar navbar-expand-lg navbar-light top-navbar">
                <div class="container-fluid">
                    <button class="btn sidebar-toggle d-md-none" id="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="navbar-search">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" placeholder="Search for courses...">
                        </div>
                    </div>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="badge notification-badge" id="notification-badge">0</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end notification-dropdown" id="notification-menu">
                                <li class="dropdown-header">
                                    <h6>Notifications</h6>
                                </li>
                                <li class="notification-item">
                                    <p>You have no new notifications</p>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <div class="form-check form-switch mode-switch">
                                <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                                <label class="form-check-label" for="darkModeSwitch">
                                    <i class="fas fa-moon"></i>
                                </label>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <div class="container-fluid">
                    <!-- Welcome Section -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="welcome-card">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h2>Welcome back, <%= user.username %>!</h2>
                                        <p class="text-muted">Ready to continue your learning journey? You have completed <span class="highlight">65%</span> of your current courses.</p>
                                        <button class="btn btn-primary btn-continue-learning">Continue Learning</button>
                                    </div>
                                    <div class="col-md-4 d-none d-md-flex justify-content-end">
                                        <img src="/img/learning-illustration.svg" alt="Learning" class="welcome-image">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="row mb-4">
                        <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                            <div class="stats-card">
                                <div class="icon-box bg-primary-light">
                                    <i class="fas fa-book-open text-primary"></i>
                                </div>
                                <div class="stats-info">
                                    <h3><%= enrolledCourses.length %></h3>
                                    <p>Enrolled Courses</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                            <div class="stats-card">
                                <div class="icon-box bg-success-light">
                                    <i class="fas fa-certificate text-success"></i>
                                </div>
                                <div class="stats-info">
                                    <h3><%= completedCourses %></h3>
                                    <p>Completed Courses</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3 mb-md-0">
                            <div class="stats-card">
                                <div class="icon-box bg-warning-light">
                                    <i class="fas fa-clock text-warning"></i>
                                </div>
                                <div class="stats-info">
                                    <h3><%= totalHours %>h</h3>
                                    <p>Learning Hours</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="stats-card">
                                <div class="icon-box bg-info-light">
                                    <i class="fas fa-star text-info"></i>
                                </div>
                                <div class="stats-info">
                                    <h3><%= avgRating %></h3>
                                    <p>Avg. Rating</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-4 mb-md-0">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Course Completion</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="courseCompletionChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Weekly Activity</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="weeklyActivityChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ongoing Courses Section -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">Ongoing Courses</h5>
                                    <a href="/courses" class="btn btn-sm btn-outline-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table course-table">
                                            <thead>
                                                <tr>
                                                    <th>Course Name</th>
                                                    <th>Instructor</th>
                                                    <th>Progress</th>
                                                    <th>Rating</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% enrolledCourses.forEach(function(course) { %>
                                                <tr>
                                                    <td>
                                                        <div class="course-info">
                                                            <img src="<%= course.image || 'https://via.placeholder.com/50' %>" alt="<%= course.title %>">
                                                            <div>
                                                                <h6><%= course.title %></h6>
                                                                <p class="text-muted"><small><%= course.duration %> hours</small></p>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td><%= course.instructor %></td>
                                                    <td>
                                                        <div class="progress">
                                                            <div class="progress-bar" role="progressbar" style="width: <%= course.progress %>%" aria-valuenow="<%= course.progress %>" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                        <small class="text-muted"><%= course.progress %>% Complete</small>
                                                    </td>
                                                    <td>
                                                        <div class="rating">
                                                            <% for(let i=1; i<=5; i++) { %>
                                                                <i class="fa<%= i <= course.rating ? 's' : 'r' %> fa-star"></i>
                                                            <% } %>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <a href="/courses/<%= course._id %>" class="btn btn-sm btn-primary">Continue</a>
                                                    </td>
                                                </tr>
                                                <% }); %>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recommended & Upcoming Section -->
                    <div class="row">
                        <div class="col-md-6 mb-4 mb-md-0">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Recommended Courses</h5>
                                </div>
                                <div class="card-body">
                                    <div class="recommended-courses">
                                        <% recommendedCourses.forEach(function(course) { %>
                                        <div class="recommended-course">
                                            <img src="<%= course.image || 'https://via.placeholder.com/70' %>" alt="<%= course.title %>">
                                            <div class="course-details">
                                                <h6><%= course.title %></h6>
                                                <p><%= course.instructor %></p>
                                                <div class="rating">
                                                    <% for(let i=1; i<=5; i++) { %>
                                                        <i class="fa<%= i <= course.rating ? 's' : 'r' %> fa-star"></i>
                                                    <% } %>
                                                    <span>(<%= course.reviews %> reviews)</span>
                                                </div>
                                                <button class="btn btn-sm btn-outline-primary join-class-btn" data-course-id="<%= course._id %>">Join Class</button>
                                            </div>
                                        </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Upcoming Schedule</h5>
                                </div>
                                <div class="card-body">
                                    <div class="upcoming-schedule">
                                        <% upcomingSchedule.forEach(function(schedule) { %>
                                        <div class="schedule-item">
                                            <div class="schedule-date">
                                                <span class="date"><%= schedule.day %></span>
                                                <span class="month"><%= schedule.month %></span>
                                            </div>
                                            <div class="schedule-details">
                                                <h6><%= schedule.title %></h6>
                                                <p><i class="fas fa-clock"></i> <%= schedule.time %> â€¢ <i class="fas fa-user"></i> <%= schedule.instructor %></p>
                                                <button class="btn btn-sm btn-outline-primary set-reminder-btn" data-schedule-id="<%= schedule._id %>">
                                                    <i class="fas fa-bell"></i> Set Reminder
                                                </button>
                                            </div>
                                        </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chatbot -->
        <div class="chatbot" id="chatbot">
            <div class="chatbot-header">
                <h6>StudySync Assistant</h6>
                <div>
                    <button class="btn-minimize" id="minimize-chatbot"><i class="fas fa-minus"></i></button>
                    <button class="btn-close" id="close-chatbot"></button>
                </div>
            </div>
            <div class="chatbot-body" id="chatbot-body">
                <div class="chat-messages" id="chat-messages"></div>
            </div>
            <div class="chatbot-footer">
                <input type="text" class="chat-input" id="chat-input" placeholder="Type your message...">
                <button class="btn-send" id="send-message"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <button class="chatbot-toggle" id="chatbot-toggle">
            <i class="fas fa-comment-dots"></i>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="/js/dashboard.js"></script>
    <script>
        // Socket.IO integration
        const socket = io();
        
        socket.on('connect', () => {
            console.log('Connected to server');
        });
        
        socket.on('notification', (notification) => {
            // Update notifications
            const badge = document.getElementById('notification-badge');
            const menu = document.getElementById('notification-menu');
            
            // Increment badge count
            let count = parseInt(badge.textContent) || 0;
            badge.textContent = count + 1;
            
            // Add notification to dropdown
            const emptyNotif = menu.querySelector('.notification-item');
            if (emptyNotif && emptyNotif.textContent.includes('no new notifications')) {
                emptyNotif.remove();
            }
            
            const newNotif = document.createElement('li');
            newNotif.className = 'dropdown-item notification-item';
            newNotif.innerHTML = `
                <div class="notification-content">
                    <p><strong>${notification.title}</strong></p>
                    <p>${notification.message}</p>
                    <small class="text-muted">${new Date().toLocaleTimeString()}</small>
                </div>
            `;
            
            // Insert after header
            const header = menu.querySelector('.dropdown-header');
            header.insertAdjacentElement('afterend', newNotif);
        });
        
        socket.on('chat message', (msg) => {
            // Add message to chatbot
            const messages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            messageDiv.textContent = msg;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        });
        
        // Send chat message
        document.getElementById('send-message').addEventListener('click', () => {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message) {
                // Add user message to chat
                const messages = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user-message';
                messageDiv.textContent = message;
                messages.appendChild(messageDiv);
                
                // Send to server
                socket.emit('chat message', message);
                
                // Clear input
                input.value = '';
                messages.scrollTop = messages.scrollHeight;
            }
        });
        
        // Allow Enter key to send messages
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('send-message').click();
            }
        });
    </script>
</body>
</html> 